# technocracy-v1.4.0.0
This version is upgraded to Angular 7 for front-end and Nest.JS is implemented for REST API.
############################################################################################
#############################Docker Manual####################################
##  Run containers using docker-compose
docker-compose up

## Build images and Run containers using docker-compose
docker-compose up --build

## Remove all images and containers using docker-compose
docker-compose rm

## List out the containers that not deleted properly 
docker ps -a --no-trunc
## Remove  container
docker rm <container_id>

## see all logs generated by the standalone container running
docker logs [-f] <container_id>

## Build images and Run containers using docker-compose without cache
docker-compose build --no-cache
docker-compose up

########################MongoDB Manual################################

# create new database into mongodb
use this link = https://stackoverflow.com/questions/35881662/show-dbs-gives-not-authorized-to-execute-command-error
######################################################################
Step - 1 : login MongoDB using extisting credentials
 mongo --port 27017 -u "<userid>" -p "<pwd>" --authenticationDatabase "admin"
Step - 2 : Create or use database
 use  technocracy_mongo_v1_3_0
Step - 3 : Add logged in user to the database
 db.createUser({user: "<userid>",pwd: "<pwd>",roles: [ { role: "readWrite", db: "technocracy_mongo_v1_3_0" } ]})
Step - 4 : check user of the database
 show users
######################################################################

# dumping database into .gz file
mongodump -d <database_name> -o <target_directory>
mongodump  -d technocracy -o tech.gz
mongodump -h 127.0.0.1:27017 -d technocracy -o tech.bson

# restoring database from .gz file to local MongoDB  
mongorestore --port <host_port> <dump_file_path>
mongorestore --port 27017 tech.gz

# restoring database from .gz file to Docker MongoDB container 
mongorestore --host 127.0.0.1 --port <host_port> <dump_file_path>
mongorestore --host 127.0.0.1 --port 27017 tech.gz
mongorestore --host 127.0.0.1 --port 27017 tech.bson\technocracy_aws_dev\blogs.bson
mongorestore --host 127.0.0.1 --port 27017 tech.bson\technocracy_aws_dev\users.bson
mongorestore --host 127.0.0.1 --port 27017 tech.bson\technocracy_aws_dev\profiles.bson
mongorestore --host 127.0.0.1 --port 27017 tech.bson\technocracy_aws_dev\comments.bson
mongorestore --host 127.0.0.1 --port 27017 tech.bson\technocracy_aws_dev\replys.bson
mongorestore --host 127.0.0.1 --port 27017 tech.bson\technocracy_aws_dev\likes.bson
#####################Importing/Exporting Database on AWS#######################
Step-1: Exporting data from AWS Database
mongodump -h ds147265.mlab.com:47265 -d technocracy_aws_dev -u <user> -p <password> -o tech.bson

Step-2: Importing data to AWS Database
mongorestore -h ds147265.mlab.com:47265 -d technocracy_aws_dev -u <user> -p <password> <input .bson file>
mongorestore -h ds147265.mlab.com:47265 -d technocracy_aws_dev -u <user> -p <password> tech.bson\technocracy\blogs.bson
mongorestore -h ds147265.mlab.com:47265 -d technocracy_aws_dev -u <user> -p <password> tech.bson\technocracy\users.bson
mongorestore -h ds147265.mlab.com:47265 -d technocracy_aws_dev -u <user> -p <password> tech.bson\technocracy\profiles.bson
mongorestore -h ds147265.mlab.com:47265 -d technocracy_aws_dev -u <user> -p <password> tech.bson\technocracy\comments.bson
mongorestore -h ds147265.mlab.com:47265 -d technocracy_aws_dev -u <user> -p <password> tech.bson\technocracy\replys.bson
mongorestore -h ds147265.mlab.com:47265 -d technocracy_aws_dev -u <user> -p <password> tech.bson\technocracy\likes.bson

#####################Importing/Exporting Database on Digital Ocean Prod Server###################
Step-1: Exporting data from Digital Ocean Prod Database
mongodump -h 139.59.84.105:27017 -d technocracy_mongo_v1_3_0 -u <user> -p <password> -o tech.bson

Step-2: Importing data to Digital Ocean Prod Database
mongorestore -h 139.59.84.105:27017 -d technocracy_mongo_v1_4_0 -u <user> -p <password> <input .bson file>
mongorestore -h 139.59.84.105:27017 -d technocracy_mongo_v1_4_0 -u <user> -p <password> tech.bson\technocracy_aws_dev\blogs.bson
mongorestore -h 139.59.84.105:27017 -d technocracy_mongo_v1_4_0 -u <user> -p <password> tech.bson\technocracy_aws_dev\questions.bson
mongorestore -h 139.59.84.105:27017 -d technocracy_mongo_v1_4_0 -u <user> -p <password> tech.bson\technocracy_aws_dev\users.bson
mongorestore -h 139.59.84.105:27017 -d technocracy_mongo_v1_4_0 -u <user> -p <password> tech.bson\technocracy_aws_dev\profiles.bson
mongorestore -h 139.59.84.105:27017 -d technocracy_mongo_v1_4_0 -u <user> -p <password> tech.bson\technocracy_aws_dev\comments.bson
mongorestore -h 139.59.84.105:27017 -d technocracy_mongo_v1_4_0 -u <user> -p <password> tech.bson\technocracy_aws_dev\replies.bson
mongorestore -h 139.59.84.105:27017 -d technocracy_mongo_v1_4_0 -u <user> -p <password> tech.bson\technocracy_aws_dev\subscriptions.bson

###################### Rename Collection Field Name#################
db.getCollection('<Collection_Name>').updateMany( {}, { $rename: { "<Field_Old_Name>": "<Field_New_Name>" } })
db.getCollection('questions').updateMany( {}, { $rename: { "commentList": "comments" } })
db.getCollection('questions').updateMany( {}, { $rename: { "user": "askedBy" } })
db.getCollection('questions').updateMany( {}, { $rename: { "likedBy": "likes" } })
db.getCollection('profiles').updateMany( {}, { $rename: { "profile": "user" } })
db.getCollection('blogs').updateMany( {}, { $rename: { "author": "profile" } })

###################### Add New Collection Field#################
db.getCollection('<Collection_Name>').update({},{$set:{"<New_Field_Name>": "<New_Field_Value>"}}, false, true)
db.getCollection('blogs').update({},{$set:{"description": ""}}, false, true)
db.getCollection('blogs').update({},{$set:{"image": ""}}, false, true)
db.getCollection('users').update({},{$set:{"profile": ""}}, false, true)


##################### Update Field Value############################
db.getCollection('<Collection_Name>').update({'<Where_Condition>':'Where_Condition_Value'},{$set:{'<Update_Column_Name>':'<Update_Column_Value>'}},{multi: true})
db.getCollection('users').update({'role':'User'},{$set:{'role':'user'}},{multi: true})

// updating profile value "<value>" to "ObjectId("<value>")"
db.getCollection('blogs').update({'profile':'59945c54d3a8604780c6e4a3'},{$set:{'profile':'ObjectId("59945c54d3a8604780c6e4a3")'}},{multi: true})
// updating askedBy value "<value>" to "ObjectId("<value>")"
db.getCollection('questions').update({'askedBy':'59945e1cd3a8604780c6e4a7'},{$set:{'askedBy':ObjectId("59945e1cd3a8604780c6e4a7")}},{multi: true})

######################Register User/Profile##########################
Step 1: Register Profile profile if it does not exists.
             REST: http://localhost:3000/api/register
             METHOD: POST
             BODY:
                 {
                                   	"username":"Vignes Aruljothi",
                                   	"email": "Vignes.Aruljothi@gmail.com",
                                   	"password": "test1234"
                                   }
Step 2: Post Profile profile if it does not exists otherwise get it from database
    REST: http://localhost:3000/api/profile/<user_id>
    METHOD: POST
    BODY:
        {
            "name":"Vignes Aruljothi",
            "designation":"Node.js Developer",
            "description":"Being a coder and entrepreneur, Vignes has a rich experience in software development and can communicate with clients effectively. He specializes in web technologies and has more than seven years of experience in building scalable applications using JavaScript and Node.js. He has a deep understanding of software development and enjoys creating software that makes a difference in peopleâ€™s lives.",
            "company":"Aricent",
            "phone":"00000000",
            "address":"Chennai, Tamil Nadu, India",
            "city":"Chennai",
            "country":"India",
            "photo":"",
            "skills":"JavaScript,Node.js,REST API,Microservices Architecture,AWS DynamoDB,Serverless Architecture,React.js,ExpressJS"
        }
    OR
    REST: http://localhost:3000/api/profile/<profile_id>
    METHOD: GET
######################Blog Post#######################################
Step 1: Post new blog
    REST: http://localhost:3000/api/blog/<profile_id>
    METHOD: POST
    BODY:
        {
                 	"title": "Implementing Serverless Node.js Functions Using Google Cloud",
                 	"content": "Creating software does not end with writing good code. It gets completed when the software is deployed and able to handle the requests properly and when we can scale without hindering the performance and the cost of running it.You are probably thinking about how you have cloud computing to take care of all these things.So what is this new serverless thing, Vignes?",
                 	"status": "pending",
                 	"tags": [ 
                         "JavaScript", 
                         "Node.js", 
                         "REST API", 
                         "Microservices Architecture", 
                         "AWS DynamoDB", 
                         "Serverless Architecture", 
                         "React.js", 
                         "ExpressJS"
                     ]
                 }
Step 2: Publish blog
    REST: http://localhost:3000/api/blog/<blog_id>        
        METHOD: PUT
        BODY:
            empty


#########################################################################
# schema changes in 1.2 version
#########################################################################
Blog :
Old : profile: [{type: String, ref: "Profile"}],
New : profile: {type: String, ref: "Profile"},
MongoDB:
Old : profile: ["6adasdasd8asdsadsad"],
New : profile: "6adasdasd8asdsadsad",

User:
Old : n/a
New : profile: {type:String, ref:"Profile"}
MongoDB:
Old : n/a,
New : profile: "6adasdasd8asdsadsad",

Profile:
Old : user:[{type:String, ref:"User"}]
New : user:{type:String, ref:"User"}
MongoDB:
Old : user: ["6adasdasd8asdsadsad"],
New : user: "6adasdasd8asdsadsad",

Question:
Old : askedBy: [{type: String, ref: "User"}],
New : askedBy: {type: String, ref: "User"},
MongoDB:
Old : askedBy: ["6adasdasd8asdsadsad"],
New : askedBy: "6adasdasd8asdsadsad",

Blog:
Old : n/a
New : submittedOn: {type: Date, required: false},
MongoDB:
Old : n/a,
New : submittedOn: ISODate("2017-08-16T14:28:19.996Z"),

Question:
Old : n/a
New : submittedOn: {type: Date, required: false},
MongoDB:
Old : n/a,
New : submittedOn: ISODate("2017-08-16T14:28:19.996Z"),